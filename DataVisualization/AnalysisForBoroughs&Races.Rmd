---
title: "BarCharts"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Attaching Libraries}
library(tidyverse)
```


```{r Barcharts for Different Boroughs, fig.height=20}
BoroughData <- read.csv("/Users/tracy/Desktop/columbia/5702/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/Preprocess_ClevelandDotPlot/OccupationByBorough.csv")
BoroughData$X <- NULL

sum_bronx <- sum(BoroughData$Bronx_County)
sum_kings <- sum(BoroughData$Kings)
sum_Manhattan <- sum(BoroughData$Manhattan)
sum_Queens <- sum(BoroughData$Queens)
sum_Richmond <- sum(BoroughData$Richmond)

BoroughData = mutate(BoroughData, 
                Bronx_pct = Bronx_County / sum(Bronx_County),
                Kings_pct = Kings / sum(Kings),
                Manhattan_pct = Manhattan / sum(Manhattan),
                Queens_pct = Queens / sum(Queens),
                Richmond_pct = Richmond / sum(Richmond))
BoroughData$Bronx_County <- NULL
BoroughData$Kings <- NULL
BoroughData$Manhattan <- NULL
BoroughData$Queens <- NULL
BoroughData$Richmond <- NULL

tidy_BoroughData <- pivot_longer(BoroughData,cols = !c(Occupations), names_to = "boroughs", values_to = "PctEmps")
tidy_BoroughData$boroughs <- as.factor(tidy_BoroughData$boroughs)
tidy_BoroughData$boroughs <- factor(tidy_BoroughData$boroughs,levels = c("Kings_pct","Queens_pct","Manhattan_pct","Bronx_pct","Richmond_pct"))

ggplot(tidy_BoroughData,aes(x=fct_reorder2(Occupations, boroughs == "Kings_pct", PctEmps), y = PctEmps)) +
  geom_col(fill = "light blue") +
  facet_wrap(~boroughs,ncol=1) +
    theme(axis.text=element_text(size=30,angle = 90, vjust = 0.5, hjust=1),
      axis.title=element_text(size=40,face="bold"),
        strip.text.x = element_text(
        size = 35, face = "bold.italic"
        ),
      strip.text.y = element_text(
        size = 35, color = "red", face = "bold.italic"
        ),
      plot.title = element_text(size = 50, face = "bold"))+
  ylab('Percentages') + xlab('Occupations') + ggtitle('Percentages Employed by Occupations for Different Boroughs in NYC')
```
As we can see from the picture above, we can discover the following things.

1）Office and administrative support occupations has the highest for all the counties other than Manhattan, where Management occupations ranks first.

2）Analyzing from different occupations individually, we discover the following:

a) Office and administrative support occupations: Manhattan has a smaller percentage of employees in this occupation compared with other boroughs.
b) Management occupations: Manhattan has a higher percentage of employees in this occupation compared with other boroughs and Bronx has a smaller percentage.
c) Arts, design, entertainment, sports, and media occupations: Kings and Manhattan have bigger percentages of employees in this occupation, while Queens, Bronx and Richmond have smaller percentages of employees in this occupation.
d) Food preparation and serving related occupations: Bronx and Queens have a bigger percentage of employees in this occupation.
e) Business and financial operations occupations: Manhattan has a bigger percentage of employees in this occupation.
f) Transportation occupations: Manhattan has a very small percentage of employees in this occupation compared with other boroughs.
g) Health diagnosing and treating practitioners and other technical occupations: Bronx has a small percentage of employment in this occupation.
h) Construction and extraction occupations: Manhattan has a very small percentage of employees in this occupation compared with other boroughs.
i) Computer and mathematical occupations: smaller percentages for Bronx and Queens.
j) Production occupations: Manhattan has a smaller percentage of employees in this occupation. Bronx and Queens have a higher percentage in this category.
k) Legal occupations: Manhattan has a higher percentage in this occupation while Bronx has a smaller one.
l) Manhattan has very small percentages of employees in Installation, maintenance, and repair occupations, Material moving occupations, Fire fighting and m) prevention, and other protective service workers including supervisors, Farming, fishing, and forestry occupations.
n) Manhattan has higher percentage of employees in Life, physical, and social science occupations.
o) Law enforcement workers including supervisors: Richmond has a higher percentage in this occupation.

# I also plan to analyze the relation between variables with a more rude category.


```{r Barcharts for Different Races, fig.height=20}
RaceData <- read.csv("/Users/tracy/Desktop/columbia/5702/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/Preprocess_ClevelandDotPlot/OccupationByRace.csv")
RaceData$X <- NULL
RaceData$Some_Other_Race_Alone <- NULL
RaceData$Two_or_More_Races <- NULL
RaceData$White_Alone_not_Hispanic_or_Latino <- NULL
  
sum_Asian <- sum(RaceData$Asian_Alone)
sum_African <- sum(RaceData$Black_or_African_American_Alone)
sum_HispanicOrLatino <- sum(RaceData$Hispanic_or_Latino)
sum_White <- sum(RaceData$White_Alone)

RaceData = mutate(RaceData, 
                Asian_pct = Asian_Alone / sum(Asian_Alone),
                African_pct = Black_or_African_American_Alone / sum(Black_or_African_American_Alone),
                Hispanic_Or_Latino_pct = Hispanic_or_Latino / sum(Hispanic_or_Latino),
                White_pct = White_Alone / sum(White_Alone))
RaceData$Asian_Alone <- NULL
RaceData$Black_or_African_American_Alone <- NULL
RaceData$Hispanic_or_Latino <- NULL
RaceData$White_Alone <- NULL

tidy_RaceData <- pivot_longer(RaceData,cols = !c(Occupations), names_to = "races", values_to = "PctEmps")
tidy_RaceData$races <- as.factor(tidy_RaceData$races)
tidy_RaceData$races <- factor(tidy_RaceData$races,levels = c("White_pct","Hispanic_Or_Latino_pct","African_pct","Asian_pct"))

ggplot(tidy_RaceData,aes(x=fct_reorder2(Occupations, races == "White_pct", PctEmps), y = PctEmps)) +
  geom_col(fill = "light blue") +
  facet_wrap(~races,ncol=1) +
    theme(axis.text=element_text(size=30,angle = 90, vjust = 0.5, hjust=1),
      axis.title=element_text(size=40,face="bold"),
        strip.text.x = element_text(
        size = 35, face = "bold.italic"
        ),
      strip.text.y = element_text(
        size = 35, color = "red", face = "bold.italic"
        ),
      plot.title = element_text(size = 50, face = "bold"))+
  ylab('Percentages') + xlab('Occupations') + ggtitle('Percentages Employed by Occupations for Different Races in NYC')
```
```

