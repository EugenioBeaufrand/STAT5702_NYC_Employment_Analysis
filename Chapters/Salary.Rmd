## salary
This sub-chapter shows an analysis of salary for different occupations in New York City.

```{r imports, include=FALSE,echo=FALSE}
library(tidyverse)
library(mosaic)
library(vcd)
library(RCurl)
library(plyr)
library(dplyr)
library(scales)
```

```{r Data, include=FALSE,echo=FALSE}
NewSalary <-read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/Salary/NewSalary.csv"))
RaceData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/Salary/NewSalary.csv"))
TidyGenderData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/Salary/TidyGenderData.csv"))
NewSalary$Occupations <- as.factor(NewSalary$Occupations)
NewSalary$Gender <- as.factor(NewSalary$Gender)
NewSalary$Boroughs <- as.factor(NewSalary$Boroughs)
NewSalary$year <- as.factor(NewSalary$year)
NewSalary$year_range <- as.factor(NewSalary$year_range)
```

```{r Data Cleaning,include=FALSE,echo=FALSE}
RaceData$Occupations<- plyr::revalue(RaceData$Occupations, c("Management occupations"="Management", "Business and financial operations occupations"="Business and financial operations","Computer and mathematical occupations" = "Computer and mathematical", "Architecture and engineering occupations" = "Architecture and engineering", "Life, physical, and social science occupations" = "Life, physical, and social science","Community and social service occupations" = "Community and social service", "Legal occupations" = "Legal", "Education, training, and library occupations" = "Education, training, and library", "Arts, design, entertainment, sports, and media occupations" = "Arts, design, entertainment, sports, and media", "Health diagnosing and treating practitioners and other technical occupations" = "Health diagnosing and treating practitioners and other technical", "Healthcare support occupations" = "Healthcare support", "Fire fighting and prevention, and other protective service workers including supervisors" = "Fire fighting and prevention", "Law enforcement workers including supervisors" = "Law enforcement workers", "Food preparation and serving related occupations" = "Food preparation and serving related", "Building and grounds cleaning and maintenance occupations" = "Building and grounds cleaning and maintenance", "Personal care and service occupations" = "Personal care and service", "Sales and related occupations" = "Sales and related", "Office and administrative support occupations" = "Office and administrative support", "Farming, fishing, and forestry occupations" = "Farming, fishing, and forestry", "Construction and extraction occupations" = "Construction and extraction","Installation, maintenance, and repair occupations" ="Installation, maintenance, and repair", "Production occupations" = "Production", "Transportation occupations" = "Transportation", "Material moving occupations" = "Material moving"))

NewSalary$Occupations<- plyr::revalue(NewSalary$Occupations, c("Management occupations"="Management", "Business and financial operations occupations"="Business and financial operations","Computer and mathematical occupations" = "Computer and mathematical", "Architecture and engineering occupations" = "Architecture and engineering", "Life, physical, and social science occupations" = "Life, physical, and social science","Community and social service occupations" = "Community and social service", "Legal occupations" = "Legal", "Education, training, and library occupations" = "Education, training, and library", "Arts, design, entertainment, sports, and media occupations" = "Arts, design, entertainment, sports, and media", "Health diagnosing and treating practitioners and other technical occupations" = "Health diagnosing and treating practitioners and other technical", "Healthcare support occupations" = "Healthcare support", "Fire fighting and prevention, and other protective service workers including supervisors" = "Fire fighting and prevention", "Law enforcement workers including supervisors" = "Law enforcement workers", "Food preparation and serving related occupations" = "Food preparation and serving related", "Building and grounds cleaning and maintenance occupations" = "Building and grounds cleaning and maintenance", "Personal care and service occupations" = "Personal care and service", "Sales and related occupations" = "Sales and related", "Office and administrative support occupations" = "Office and administrative support", "Farming, fishing, and forestry occupations" = "Farming, fishing, and forestry", "Construction and extraction occupations" = "Construction and extraction","Installation, maintenance, and repair occupations" ="Installation, maintenance, and repair", "Production occupations" = "Production", "Transportation occupations" = "Transportation", "Material moving occupations" = "Material moving"))

TidyGenderData$Occupations<- plyr::revalue(TidyGenderData$Occupations, c("Management occupations"="Management", "Business and financial operations occupations"="Business and financial operations","Computer and mathematical occupations" = "Computer and mathematical", "Architecture and engineering occupations" = "Architecture and engineering", "Life, physical, and social science occupations" = "Life, physical, and social science","Community and social service occupations" = "Community and social service", "Legal occupations" = "Legal", "Education, training, and library occupations" = "Education, training, and library", "Arts, design, entertainment, sports, and media occupations" = "Arts, design, entertainment, sports, and media", "Health diagnosing and treating practitioners and other technical occupations" = "Health diagnosing and treating practitioners and other technical", "Healthcare support occupations" = "Healthcare support", "Fire fighting and prevention, and other protective service workers including supervisors" = "Fire fighting and prevention", "Law enforcement workers including supervisors" = "Law enforcement workers", "Food preparation and serving related occupations" = "Food preparation and serving related", "Building and grounds cleaning and maintenance occupations" = "Building and grounds cleaning and maintenance", "Personal care and service occupations" = "Personal care and service", "Sales and related occupations" = "Sales and related", "Office and administrative support occupations" = "Office and administrative support", "Farming, fishing, and forestry occupations" = "Farming, fishing, and forestry", "Construction and extraction occupations" = "Construction and extraction","Installation, maintenance, and repair occupations" ="Installation, maintenance, and repair", "Production occupations" = "Production", "Transportation occupations" = "Transportation", "Material moving occupations" = "Material moving"))

detach(package:plyr)
```

```{r theme,include=FALSE}
mytheme <- theme(axis.text=element_text(size = 10),
  axis.title=element_text(size=12, face = "bold"),
  plot.title = element_text(size = 14, face = "bold"),
  legend.title = element_text(size = 12),
  legend.text = element_text(size = 10))

mytheme1 <- theme(axis.text=element_text(size = 10),
  axis.title=element_text(size=12, face = "bold"),
  plot.title = element_text(size = 18, face = "bold"),
  legend.title = element_text(size = 12),
  legend.text = element_text(size = 10))

mytheme2 <- theme(axis.text=element_text(size = 10),
  axis.title=element_text(size=12, face = "bold"),
  plot.title = element_text(size = 15, face = "bold"),
  legend.title = element_text(size = 12),
  legend.text = element_text(size = 10))
```


```{r scale,include=FALSE}
ks <- function (x) { number_format(accuracy = 1,
                                   scale = 1/1000,
                                   suffix = "k",
                                   big.mark = ",")(x) }
```


### Overview of Salary Distribution

In order to have an overview of salary distribution according to different occupations in New York City, we draw a Cleveland Dot Plot to show the 10-year-average salary of different occupations first.

```{r Overview of Salary Distribution,fig.width=10}
ggplot(NewSalary) +
  geom_point(aes(Salary_occupation, reorder(Occupations,Salary_occupation)),color = "royalblue3", size = 2, alpha = 0.75) + ylab('Occupation') + xlab('Salary') + 
  ggtitle('Average Salaries of Different Occupations in NYC') +
  scale_x_continuous(labels = ks)+
  mytheme
```

**Observations on Average Salaries by Occupation in NYC:**

1. Huge Differences in Salary for Different Occupations.

  * There is a huge difference in salary for different kinds of occupations. The range is up to `r as.integer(max(NewSalary$Salary_occupation) - min(NewSalary$Salary_occupation))`, which is about `r as.integer((max(NewSalary$Salary_occupation) - min(NewSalary$Salary_occupation))/min(NewSalary$Salary_occupation))` times of minimum salary.

2. Five clusters for salary distribution. 

  * The **first** group is `Legal`, which has much higher average salary compare with all other occupations.
  * The **second** group includes 7 different occupations, which ranks second in salary levels among all occupations. We can also divide the second group into four sub-groups according to the salary. 
    * The first sub-group only includes `Health diagnosing and treating practitioners and other technical`, which has the second largest salary.
    * The second sub-group includes `Computer and mathematical` and `Management`. They have very similar average salary, the difference in salary of the two occupations is only `r as.integer(NewSalary[21,13] - NewSalary[251,13])`.
    * The third sub-group includes `Law enforcement workers`, `Business and financial operations` and `Architecture and engineering`. The salary range of this sub-group is also small, it is `r as.integer(NewSalary[23861,13] - NewSalary[31,13])`.
    * The fourth sub-group contains only one occupation, which is `Life, physical, and social science`
  * The **third** group contains `Arts, design, entertainment, sports, and media`, `Health technologists and technicians`, `Education, training, and library`, `Installation, maintenance, and repair`, `Community and social service` and `Construction and extraction`. The salary range of this group is `r as.integer(NewSalary[1334,13] - NewSalary[1704,13])`.
  * The **Fourth** group contains `Office and administrative support`, `Sales and related`, `Transportation` and `Fire fighting and prevention`. The salary range of this group is `r as.integer(NewSalary[1934,13] - NewSalary[1879,13])`.
  * The **Fifth** group contains `Production`, `Healthcare support`, `Building and grounds cleaning and maintenance`, `Material moving`, `Personal care and service`, `Farming, fishing, and forestry`, `Food preparation and serving related`. The salary range of this group is `r as.integer(NewSalary[974,13] - NewSalary[2144,13])`.

3. Gaps between the five clusters.

  * From the first group to the fifth group, the salary gap between groups is `r as.integer(NewSalary[818,13] - NewSalary[100,13])`, `r as.integer(NewSalary[41,13] - NewSalary[1334,13])`, `r as.integer(NewSalary[1704,13] - NewSalary[1934,13])`, `r as.integer(NewSalary[1879,13] - NewSalary[2144,13])`.
  * Among all the gaps, the biggest one is between group 2 and group 3, and the gap is `r as.integer(NewSalary[41,13] - NewSalary[1334,13])`. The smallest gap is between gtoup 3 and group 4, and the gap is `r as.integer(NewSalary[1704,13] - NewSalary[1934,13])`.
  
4. Top 3 and Last 3 Occupations in Salaries.

  * Top 3
    * Legal
    * Health diagnosing and treating practitioners and other technical
    * Computer and mathematical
  * Last 3
    * Personal care and service
    * Farming, fishing, and forestry
    * Food preparation and serving related
  
  * As can be seen from the plot, the salary range for the top 3 occupations are large. However, for the last 3 occupations, the salary range is relatively small.

### Analyze on Salary by Years

One of the things that affects salary is time. So first, we have an analysis on salaries in different years.

#### General Trend of Salary by Years

```{r,fig.width=10}
NewSalary1 <- NewSalary[NewSalary$year == "year2010" | NewSalary$year == "year2015" | NewSalary$year == "year2019",]
NewSalary1$year<- plyr::revalue(NewSalary1$year, c("year2010" = "2010","year2015"="2015","year2019"="2019"))

ggplot(NewSalary1) +
  geom_point(aes(Salary_year, reorder(Occupations,Salary_avg), color = year),size = 2, alpha = 0.75) + ylab('Occupation') + xlab('Salary') + 
  ggtitle('Salaries of Different Occupations NYC')+
  scale_x_continuous(labels = ks)+
  mytheme
```

**Observations on Salaries by Occupation NYC through 2010-2019:**

1. Salary Trends for Top 3 and Last 3 Occupations\

Top 3\

1.) Legal occupations\

This occupation is in an monotonous increasing trend in salary, and the increasing speed is also becoming faster.\

2.) Health diagnosing and treating practitioners and other technical occupations\

This occupation also has a monotonous increasing trend in salary.\

3.) Computer and mathematical occupations\

This occupation also has a monotonous increasing trend in salary.\

Last 3\

1.) Food preparation and serving related occupations\

This occupation has the lowest salary within the year range in 2010. However, its salary is in an increasing trend by years.\

2.) Farming, fishing, and forestry occupations\

The salary for this occupation decreased first and then increased. However, it still did not reach the salary level in 2019 as it was in 2010.\

3.) Personal care and service occupations\

The salary trend for this occupation also decreased first and then increased. Different from the occupation of farming, fishing, and forestry occupations, the salary only dropped a little bit first and then increased a lot. Therefore, generally speaking, the salary of this occupation increased.\


In order to see the salary variances of the 25 occupations in detail, we draw boxplot for comparisons.\

```{r,fig.width=10,fig.height=6}
ggplot(NewSalaryWithVariance) +
  geom_boxplot(aes(y = reorder(x = Occupations, Salary_YearlyAvg, FUN = median), x = Salary_YearlyAvg),
               color = "black", fill = "dark red", alpha = 0.7) + 
  scale_x_continuous(labels = ks)+
  ggtitle("Boxplots with Number of Employed for Different Occupations") +
  xlab("occupations")+
  mytheme2
```

**Observations from Boxplot of salaries per year:**

Salaries that seem prone to dramatic fluctuation over time:\

1.) Legal occupations\

2.) Computer and Mathematical occupations\

3.) Architecture and engineering occupations\

4.) Life, physical, and social science\

5.) Farming, fishing, and forestry occupations\

Salaries where the number of employees has fluctuated very little:\

1.) Law enforcement\

2.) Health technologists and technicians\

3.) Installation, maintenance, and repair\

4.) Community and social service\

5.) Healthcare support\

6.) Material moving\

When reading this plot is that the salaries in any particular occupation may change the viewers perception as to what constitutes more variation. To address this, a second plot has been created in which the box plots are normalized by dividing the salaries in each year by the mean across this sector. While the variation won't be apparent, the relative degrees of fluctuation will become more apparent.
\

```{r Yearly Normalized BoxPlot,fig.width=10,fig.height=6}
NewSalaryWithVariance2 <- NewSalaryWithVariance %>% select(1,2,5)%>%unique()
NewSalaryWithVariance2$Normalized<-NewSalaryWithVariance2$Salary_YearlyAvg/NewSalaryWithVariance2$Salary_occupation
  
ggplot(NewSalaryWithVariance2) +
  geom_boxplot(aes(x = Normalized, y = reorder(x = Occupations,Normalized, FUN = median)),
               color = "black", fill = "dark red", alpha = 0.7) + 
  ggtitle("Normalized salary in sector per year") +
  xlab("Salary") + ylab("Occupations") +
  mytheme1
```

**Observations from salaries in sector per year:**

In this plot, the total values of employees working in each field in each year are normalized by their averages. There are something special you can see from this normalized boxplot.\

1.) Farming, fishing and forestry ranks first in variation in salaries.
This makes sense because this occupation has relatively low salaries, so when normalized, it is more likely to show high variation in salary by years.\

2.) Construction and extraction also has huge variance, even when the average salary for this occupation is not very low.
There are two outliers in this sector, in 2010, it has the lowest salary which is 26284, and in 2018, it has the highest salary which is 56175. Without the two data points, the variance will be much smaller. There might be more buildings under construction in 2018 and much fewer in 2010.\

3.) Healthcare support and Law enforcement workers are the two most stable sectors in salaries.
Among all the occupations, Healthcare support and Law enforcement workers has the smallest variance after normalized. Of all the occupation types, it seems that law enforcement occupations have the most stable salaries. This might be because the salaries for these kinds of jobs are set by the local government, and government jobs tend to have stable and consistent pay.\


#### Monotonicity in Salary Trends

Usually, we tend to think salaries should have increasing trends by years. From the plot, however, we can discover the salaries do not have an increasing trend for all types of occupations. Among all types of occupations, only two types of occupations have lower salaries in the 2019 than in 2010 to 2013, namely, farming, fishing and forestry occupations and healthcare support occupations. Generally speaking, there are two different trends of salaries, namely, a monotonous increasing trend, which includes 18 occupations, and the trend that first decreases then increases, which includes 7 occupations.

##### Monotonous Increase

There are kinds of occupations in this trend group.
1. Legal occupations
2. Health diagnosing and treating practitioners and other technical occupations
3. Computer and mathematical occupations
4. Management occupations
5. Business and financial operations occupations
6. Architecture and engineering occupations
7. Arts, design, entertainment, sports, and media occupations
8. Education, training, and library occupations
9. Installation, maintenance, and repair occupations
10. Community and social service occupations
11. Construction and extraction occupations
12. Office and administrative support occupations
13. Sales and related occupations
14. Transportation occupations
15. Production occupations
16. Building and grounds cleaning and maintenance occupations
17. Material moving occupations
18. Food preparation and serving related occupations

##### First Decrease Then Increase

1. Law enforcement workers including supervisors
2. Life, physical, and social science occupations
3. Health technologists and technicians
4. Fire fighting and prevention, and other protective service workers including supervisors
5. Healthcare support occupations
6. Personal care and service occupations
7. Farming, fishing, and forestry occupations

In this category, the salaries of some occupations decreased a lot and then increased a little, which makes these categories have a decreasing trend in general. However, for other occupations, the salaries decreased a little first and then increased a lot. For these occupations, they are in an increasing trend in general. To learn more about the exact changing trends of salaries in this group, we draw scatter plots to analyze the trends of these occupations in detail.

##### Detailed Analysis on "First Decrease Then Increase" Occupations

```{r,fig.height=11,fig.width=10}
ggplot(NotMonotonous1,aes(year,Salary_YearlyAvg,group = Occupations)) +
  geom_line(size = 1,color = "black") +
  geom_point(color = "royalblue3", size = 2) +
  facet_wrap(~Occupations,ncol=2,scales = "free_y") +
  scale_y_continuous(labels = ks)+
  theme(axis.text=element_text(size=8),
      axis.title=element_text(size=15,face="bold"),
        strip.text.x = element_text(
        size = 12, face = "bold.italic"
        ),
      strip.text.y = element_text(
        size = 12, color = "red", face = "bold.italic"
        ),
      plot.title = element_text(size = 18, face = "bold"))+
  ylab('Salary') + xlab('Occupations') + ggtitle('Salaries of Different Years by Occupations in NYC')
```

**Observations from sectors without clear salary trends:**

From the above plots, we see both the variations in salaries and the general trends for these occupations.\
1. Law enforcement workers including supervisors\
For this occupation, the salary is in the trend of a wave. The crests are in year 2011, year 2015, and year 2019. The troughs are in year 2012 and year 2016. Besides, there are two special points for this occupation.\
a) The salary dropped a lot from 2015 to 2016, and then returned to normal quickly from 2016 to 2017.\
b) The salary was in an decreasing trend from 2017 to 2018, but it did not continue to decrease, instead, it increased a lot from year 2018 to 2019.\
2. Life, physical, and social science occupations\
For this occupation, the salary is in also in the trend of a wave. At the same time, it is in an increasing trend in general. The crests are in year 2013 and 2018. The troughs are in year 2012 and 2014.\
3. Health technologists and technicians\
From year 2010 to 2013, the salary of this occupation grew slightly at a steady rate. However, from 2014 to 2015, the salary had a sudden drop. After that, the salary started to increase at a higher rate.\
4. Fire fighting and prevention, and other protective service workers including supervisors\
The salary of this group is in a waving trend and remains at a certain level in general. The crests are in 2012, 2013 and 2017, and the troughs are in 2011 and 2016. However, there is a special point for this occupation.\
a) The salary had a sudden increase from year 2016 to year 2017.\
5. Healthcare support occupations\
Generally speaking, the salary trend is in a decreasing trend. The crests occurred in year 2010, 2013, and 2015. The troughs occured in year 2014 and 2017.\
6. Personal care and service occupations\
Generally speaking, the salary of this occupation is in an increasing trend. It remained relatively stable before 2015, after that, the salary increased at a relatively high speed.\
7. Farming, fishing, and forestry occupations\
For this occupation, it salary increased a little from 2011 to 2012, and then began to decrease at a high speed from 2012 to 2014. After that, the salary recovered at a lower but steady speed.\

#### Percentage Difference by Years

It is also very important to analyze on the variations of salaries of different occupations. Because different occupations have different base wages, sometimes it might be more meaningful to calculate the percentage of wage fluctuations in wages. Here, we use the average wages to represent the wage of different occupations.

```{r,include=FALSE,echo=FALSE}
# add difference to NewSalary
# occupation, year, Salary_YearlyAvg
NewSalaryWithVariance <- NewSalary %>% select(1, 4, 11, 13)
NewSalaryWithVariance <- unique(NewSalaryWithVariance)

NewSalaryWithVariance.wide <- pivot_wider(NewSalaryWithVariance, names_from = year, values_from = Salary_YearlyAvg)

NewSalaryWithVariance.wide$variance <- with(NewSalaryWithVariance.wide, year2019 - year2010)

NewSalaryWithVariance.tidy <- pivot_longer(NewSalaryWithVariance.wide, cols = c(3:12), names_to = "year", values_to = "Salary_YearlyAvg")

<<<<<<< HEAD
# write.csv(NewSalaryWithVariance.tidy,"/Users/tracy/Desktop/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/Salary/NewSalaryWithVariance.csv", row.names = FALSE)
=======
#write.csv(NewSalaryWithVariance.tidy,"/Users/tracy/Desktop/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/Salary/NewSalaryWithVariance.csv", row.names = FALSE)
>>>>>>> 7828a252610b57fb1a827ae0095de1d232b0f23b
```


```{r,fig.height=6,fig.width=10}
# draw cleveland dot plot according to variance

NewSalaryWithVariance <- read_csv("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/Salary/NewSalaryWithVariance.csv")
NewSalaryWithVariance$year <- as.factor(NewSalaryWithVariance$year)
NewSalaryWithVariance$Occupations <- as.factor(NewSalaryWithVariance$Occupations)

NewSalaryWithVariance1 <- NewSalaryWithVariance[NewSalaryWithVariance[, "year"] == "year2010",]

NewSalaryWithVariance1 <- NewSalaryWithVariance1 %>% 
  mutate(variance_pct = (variance/Salary_YearlyAvg))

NewSalaryWithVariance1 <- NewSalaryWithVariance1
NewSalaryWithVariance1 <- NewSalaryWithVariance1%>%select(1,5) %>% unique()

ggplot(NewSalaryWithVariance1,aes(x=fct_reorder(Occupations, abs(variance_pct)), y = variance_pct)) +
  geom_col(fill = "royalblue3",alpha = 0.75)+
  coord_flip()+
    theme(axis.text=element_text(),
      axis.title=element_text(face="bold"),
      plot.title = element_text(face = "bold"))+ xlab('Occupations') + ylab('Percentage Difference') + ggtitle('Percentage Difference of Salaries over Years')+
  mytheme
```

<<<<<<< HEAD
**Observations from percentage difference of salary via gender:**
=======
## Boxplot
In order to see the salary variances of the 25 occupations in detail, we draw boxplot for comparisons.
```{r,fig.width=10,fig.height=6}
ggplot(NewSalaryWithVariance) +
  geom_boxplot(aes(y = reorder(x = Occupations, Salary_YearlyAvg, FUN = median), x = Salary_YearlyAvg),
               color = "black", fill = "dark red", alpha = 0.7) + 
  scale_x_continuous(labels = ks)+
  ggtitle("Boxplots with Number of Employed for Different Occupations") +
  xlab("occupations")+
  mytheme2
```
**Observations from Boxplot of salaries per year:**

Salaries that seem prone to dramatic fluctuation over time:\

1.) Legal occupations\

2.) Computer and Mathematical occupations\

3.) Architecture and engineering occupations\

4.) Life, physical, and social science\

5.) Farming, fishing, and forestry occupations\

Salaries where the number of employees has fluctuated very little:\

1.) Law enforcement\

2.) Health technologists and technicians\

3.) Installation, maintenance, and repair\

4.) Community and social service\

5.) Healthcare support\

6.) Material moving\

When reading this plot is that the salaries in any particular occupation may change the viewers perception as to what constitutes more variation. To address this, a second plot has been created in which the box plots are normalized by dividing the salaries in each year by the mean across this sector. While the variation won't be apparent, the relative degrees of fluctuation will become more apparent.
\

```{r Yearly Normalized BoxPlot,fig.width=10,fig.height=6}
NewSalaryWithVariance
NewSalaryWithVariance2 <- NewSalaryWithVariance %>% select(1,2,5)%>%unique()
NewSalaryWithVariance2$Normalized<-NewSalaryWithVariance2$Salary_YearlyAvg/NewSalaryWithVariance2$Salary_occupation
  
ggplot(NewSalaryWithVariance2) +
  geom_boxplot(aes(x = Normalized, y = reorder(x = Occupations,Normalized, FUN = median)),
               color = "black", fill = "dark red", alpha = 0.7) + 
  ggtitle("Normalized salary in sector per year") +
  xlab("Salary") + ylab("Occupations") +
  mytheme1
```

**Observations from salaries in sector per year:**
>>>>>>> 7828a252610b57fb1a827ae0095de1d232b0f23b

As we can see from the above plot, we can discover that the majority of these occupations have increased in salaries in the past decade. Only two of these categories have decreased in salaries. Among all occupations, the occupation of Construction and extraction occupations has the biggest Percentage Difference  in salary in 2010 and 2019, and the occupation of Healthcare support occupations have the smallest.\


### Analyze on Salary by Counties

```{r,fig.width=10}
ggplot(NewSalary) +
  geom_point(aes(Salary_county, reorder(Occupations,Salary_county), color = Boroughs),size = 2, alpha = 0.75) + ylab('Occupation') + xlab('Salary') + 
  ggtitle('Salaries of Different Occupations of Different Counties in NYC')+
  mytheme
```

**Observations on Salaries by Occupation NYC for different counties:**

As can be seen in this plot, for different occupations, the counties with the highest and lowest wages in each occupation are different. For the majority of the occupations, the highest salaries are in New York County and their lowest salaries are in Bronx County. For the relatively low-paid occupations, the highest salaries are in Richmond County.\

#### Distribution of the Highest and Lowest Wages in Different Counties

We draw a dodged bar chart to reflect the specific distribution data of the highest and lowest wages in different counties.\

```{r,fig.width=8,echo=FALSE}
# use 0 or 1 to mark the boroughs with min and max
CountySalary <- NewSalary %>% select(1, 3, 9,13)
CountySalary <- unique(CountySalary)

CountySalary <- CountySalary %>% 
  group_by(Occupations) %>% 
  mutate(MinValue = min(Salary_county), MaxValue = max(Salary_county)) %>%
  ungroup()

CountySalary$index <- ifelse(CountySalary$Salary_county == CountySalary$MaxValue, "Highest Salary", 
                             ifelse(CountySalary$Salary_county == CountySalary$MinValue, "Lowest Salary", 0))

CountySalary2 <- CountySalary[CountySalary$index == "Highest Salary" | CountySalary$index == "Lowest Salary",]
CountySalary2 <- CountySalary2 %>% select(1,2,7) 

CountySalary2$index <- as.factor(CountySalary2$index)
CountySalary2 %>%
group_by(Boroughs, index,.drop = FALSE) %>%
summarize(count=n()) %>%
  ungroup() %>%
ggplot(aes(fill=index,y=count, x=Boroughs)) +
geom_bar(position=position_dodge2(padding = 0.1),stat="identity") +
xlab("Boroughs")+
ylab("Count")+
ggtitle("Distribution of the Highest and Lowest wages in Different Counties") + 
  mytheme
```
**Observations on the Distribution of the Highest and Lowest wages in Different Counties:**

As can be seen from this plot, many occupations have the lowest salaries in Bronx County, some of them are in Kings County and New York County, but none of them appears in Queens County and Richmond County.\

For the occupations with highest salaries, the majority of them are in New York County and Richmond County. Several of them also appear in Queens County, but none of them appear in Bronx County and Kings County.\

To see whether there are changes of the distribution of highest and lowest wages in different countries, we draw a stacked bar chart by years. We use different colors to represent different counties.

```{r,fig.width=9,echo=FALSE}
CountyYearlySalary <- NewSalary %>% select(1, 3, 4, 12)
CountyYearlySalary <- unique(CountyYearlySalary)

CountyYearlySalary <- CountyYearlySalary %>% 
  group_by(Occupations, year) %>% 
  mutate(MinValue = min(Salary_CountyYear), MaxValue = max(Salary_CountyYear)) %>%
  ungroup()

CountyYearlySalary$index <- ifelse(CountyYearlySalary$Salary_CountyYear == CountyYearlySalary$MaxValue, "Highest Salary", 
                             ifelse(CountyYearlySalary$Salary_CountyYear == CountyYearlySalary$MinValue, "Lowest Salary", 0))

CountyYearlySalary <- CountyYearlySalary[CountyYearlySalary$index == "Highest Salary" | CountyYearlySalary$index == "Lowest Salary",]
CountyYearlySalary <- CountyYearlySalary %>% select(1,2,3,7) 
CountyYearlySalary$index <- as.factor(CountyYearlySalary$index)

summary <- CountyYearlySalary %>%
  group_by(index,year,Boroughs) %>%
  summarize(count=n()) %>%
  mutate(prop = count/sum(count))

summary$year<- plyr::revalue(summary$year, c("year2010" = "2010","year2011"="2011","year2012"="2012","year2013"="2013","year2014"="2014","year2015"="2015","year2016"="2016","year2017"="2017","year2018"="2018","year2019"="2019"))

ggplot(data = summary, aes(fill=Boroughs, x=year, y=prop)) +
           geom_bar(position='fill', stat='identity') +
           facet_wrap(~index, ncol=1) +
  xlab("Year")+
  ylab("Probability")+
  ggtitle("Probability of having the Highest/Lowest Salaries in Different Counties") + 
  mytheme
```

**Observations on the Probability of having the Highest/Lowest Salaries in Different Counties:**

As can be seen in this plot, from the perspective of each year alone, the situation is slightly different from the overall average, which is reflected in the following aspects.\

1. For the highest salary\

In the overall trend, maximum salary for all occupations do not lie in Bronx County and Kings County. However, as can be seen from the stacked bar chart, in year 2010, 2012, 2013 and 2014, there are some occupations with highest salary in Bronx County. Also, except for year 2014 and year 2017, there are some occupations with highest salary in Kings County.\

2. For the lowest salary\

In the overall trend, minimum salary for all occupations do not lie in Queens County and Richmond County. However, as can be seen from the stacked bar chart, except for year 2013, there are some occupations with lowest salary in Queens County. Also, except for year 2018, there are some occupations with lowest salary in Richmond County.\

3. Percentage Difference in salaries between different counties\

We also discover that the variations among different boroughs for different occupations are different. Therefore, we use a bar chart to order the degree of variance among different boroughs for all types of occupations. For each occupation, we use the salary in five counties to minus the smallest salary, add them up and divide the sum by 5. Then, we  divide the value by the smallest salary to represent the variance of each occupation.\


#### Percentage Difference of Salaries in Different Counties


```{r,fig.height=6, fig.width=10}
CountySalary3 <- CountySalary %>% select(1:5)
CountySalary3$variance <- with(CountySalary3, Salary_county - MinValue)

CountySalary3 <- CountySalary3 %>% 
  group_by(Occupations) %>% 
  mutate(variance_pct = (sum(variance)/5)/Salary_occupation) %>%
  ungroup() %>% select(1,7) %>% unique()

ggplot(CountySalary3,aes(x=fct_reorder(Occupations, variance_pct), y = variance_pct)) +
  geom_col(fill ="royalblue3",alpha = 0.75)+
  ylab('Percentage Difference') + xlab('Occupations') +
  coord_flip()+ 
  ggtitle('Percentage Difference of Salaries in Different Counties') +
  mytheme
```

**Observations on Percentage Difference of Salaries in Different Counties:**

1. Top 5 in Variation\

1.) Sales and related occupation\

2.) Legal occupations\

3.) Management occupations\

4.) Farming, fishing, and forestry occupations\

5.) Arts, design, entertainment, sports, and media occupations\

2. Last 5 in Variation\

1.) Personal care and service occupations\

2.) Health technologists and technicians\

3.) Community and social service occupations\

4.) Food preparation and serving related occupations\

5.) Life, physical, and social science occupations\


### Analyze on Salary by Genders

```{r, fig.width=10}
ggplot(NewSalary) +
  geom_point(aes(Salary_gender, reorder(Occupations,Salary_gender), color = Gender),size = 2, alpha = 0.75) + ylab('Occupation') + xlab('Salary') + 
  ggtitle('Salaries of Different Occupations of Different Genders in NYC') +
  scale_color_manual(values=c('seagreen3','mediumorchid'))+
  mytheme
```

**Observations on the Salaries of Different Occupations of Different Genders in NYC:**

As can be seen in this Cleveland dot plot, the salaries of some occupations varies a lot between different genders, while some other occupations have similar salaries for two genders. Also, for some kinds of occupations, male have higher salaries and for other kinds of occupations, woman have higher salaries. To have a deeper understanding of these characteristics, we have a deeper analysis on salaries for different genders in different occupations.\

#### Percentage Difference of Salaries between Genders

We use a bar chart to order the salary variance between genders for different occupations. To quantify the difference, we divide the income difference between male and female by the average salary of the occupation.\

```{r,fig.height=6,fig.width=10}
GenderSalary <- NewSalary %>% select(1, 2, 10,13)
GenderSalary <- unique(GenderSalary)

GenderSalary <- pivot_wider(GenderSalary, names_from = "Gender", values_from = "Salary_gender")
GenderSalary$variance <- with(GenderSalary, Male - Female)

GenderSalary <- GenderSalary %>% 
  mutate(variance_pct = variance/Salary_occupation)

ggplot(GenderSalary,aes(x=fct_reorder(Occupations, abs(variance_pct)), y = variance_pct)) +
  geom_col(fill = "royalblue3",alpha = 0.75)+
  coord_flip()+
    theme(axis.text=element_text(),
      axis.title=element_text(face="bold"),
      plot.title = element_text(face = "bold"))+ xlab('Percentage Difference') + ylab('Occupations') + ggtitle('Percentage Difference of Salaries for Different Genders')+
  mytheme

```

**Observations on the Percentage Difference of Salaries for Different Genders:**

From the horizontal bar chart above, we discover the following characteristics.\

For most of the occupations, male employees have higher salaries than female employees. Female employees only have higher salaries in 4 kinds of occupations among the 25 kinds of occupations, namely, Construction and extraction occupations, Installation, maintenance, and repair occupations, Community and social service occupations, and Transportation occupations.\


##### Top 5 and Last 5 in Variance

1. Top 5\

1.) Sales and related occupations\

2.) Building and grounds cleaning and maintenance occupations\

3.) Material moving occupations\

4.) Production occupations\

5.)Personal care and service occupations\


2. Last 5\

1.) Transportation occupations\

2.) Office and administrative support occupations\

3.) Community and social service occupations\

4.) Installation, maintenance, and repair occupations\

5.) Computer and mathematical occupations


####Relation between Percentage Differenct of Employment and Salary in Gender

Intuitively, the gender composition of employees in a profession is related to the level of wages for gender. We want to analyze if this intuition makes sense. Therefore, we use two categorical variables to represent the two characteristics, namely "Gender Distribution" and "Salary Distribution". For the category of "Gender Distribution", there are two values, Male-dominated, which means there are more male employees in this occupation than female employees, and Female-dominated, which means there are more female employees in this occupation than male employees. For the category of "Salary Distribution", we also set two values, Male-higher, which means male employees have higher salary in this occupation, and Female-higher, which means female employees have higher salary in this occupation. Then, we draw a mosaic plot to measure the relation.\

```{r,fig.width=6,echo=FALSE}
TidyGenderData <- TidyGenderData %>% select(1,2) %>% unique()

GenderSalary$Salary_Distribution <- ifelse(
  ( 
        (GenderSalary$variance_pct > 0) 
    ),
  "Male-higher",
  "Female-higher"
)

GenderSalary2 <- GenderSalary %>% select(1,7) %>% unique()

GenderNumSal <- merge(TidyGenderData,GenderSalary2,by="Occupations")

colors <- tibble('0' = "#8461c1", '1' = "#5e3c99")

mosaic(Gender.Distribution ~ Salary_Distribution, direction = "v", GenderNumSal, highlighting_fill = c(colors$'0', colors$'1'),
       main = "Gender Distribution vs Salary Distribution")

```

From this mosaic plot, we can see that salary distribution is related to gender composition. However, the characteristic of this connection is against tuition. We tend to think that in the "Female-higher" salary distribution group, there will be more female-dominated occupations, and in the "Male-higher" salary distribution group, there will be more male-dominated occupations. However, the conclusion from the plot is opposite against our tuition.

