---
title: "Education.Rmd"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Imports}
library(tidyverse)
library(RCurl)
library(dplyr)
library(scales)
```

```{r Data}
Education <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/Education.csv"))
PropBachelor <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/PropBachelor.csv"))
PropBachelorByGender <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/PropBachelorByGender.csv"))
Education <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/Education.csv"))
Salary_edu <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/salary_edu.csv"))
NumEmp_edu <-read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/numemp_sum_races_combined.csv"))
SalaryByPropEdu <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/education/PropEducatedBySalary.csv"))
```

```{r Data Transformation or Cleaning}
Education$X <- NULL
Education$Education_Level <- as.factor(Education$Education_Level)
Education$Education_Level <-plyr::revalue(Education$Education_Level, c("Bechelor's Degree or Higher" = "Bachelor's Degree or Higher"))
NumEmp_edu$X <- NULL
Salary_edu$X <- NULL
```

```{r NYC Salary by Education Level}
# New York Analysis
# New York Salary
New_YorkSalary <- Salary_edu[which(Salary_edu$Boroughs=='New York County'), ]
New_YorkSalary$year <- sub("year","",New_YorkSalary$year)
New_YorkSalary <- New_YorkSalary %>% select(1,3,4)

# New_YorkEducation
New_YorkEducation <- Education %>% select(1,11,12,13,20)
New_YorkEducation$Education_Level <- as.factor(New_YorkEducation$Education_Level)
New_YorkEducation$year <- as.factor(New_YorkEducation$year)
New_YorkEducation <- New_YorkEducation %>% pivot_longer(cols = !c(Education_Level,year),names_to = "Location_Gender", values_to = "count")
New_YorkEducation$Gender <- ifelse(New_YorkEducation$Location_Gender == "New.York.County..Total", "Total", 
                             ifelse(New_YorkEducation$Location_Gender == "New.York.County..Female", "Female", "Male"))
New_YorkEducation <- New_YorkEducation %>% pivot_wider(names_from = "Education_Level", values_from = "count")
New_YorkEducation <- New_YorkEducation %>% select(1,3,4,5,6,7,8)
New_YorkEducation<-New_YorkEducation[!(New_YorkEducation$Gender=="Total"),]

# New_YorkNumEmp
New_YorkNumEmp <- NumEmp_edu %>% select(1,2,5) %>% unique()
New_YorkNumEmp$Gender <- sub("Total Male","Male",New_YorkNumEmp$Gender)
New_YorkNumEmp$Gender <- sub("Total Female","Female",New_YorkNumEmp$Gender)
New_YorkNumEmp <- New_YorkNumEmp %>% dplyr::rename("NumEmp" = "New_York")
New_YorkNumEmp<-New_YorkNumEmp[!(New_YorkNumEmp$Gender=="Total"),]

# merge
Total_New_York <- merge(New_YorkSalary,New_YorkEducation,by = c("year","Gender"))
Total_New_York <- merge(Total_New_York,New_YorkNumEmp,by = c("year","Gender"))
Total_New_York <- Total_New_York %>% pivot_longer(cols = c(4,5,6,7,8), names_to = "Education_Level",values_to = "NumEducated")
Total_New_York$year <- as.factor(Total_New_York$year)
Total_New_York$Gender <- as.factor(Total_New_York$Gender)
Total_New_York$Education_Level <- as.factor(Total_New_York$Education_Level)


# plot
ggplot(Total_New_York,aes(NumEducated,NumEmp,color = Gender)) +
  geom_point()+
  facet_wrap(~Education_Level,scales = "free_x",ncol = 2) + ggtitle("Number Educated vs Number Employed from 2010-2019")

ggplot(Total_New_York,aes(NumEducated,Salary_CountyGender,color = Gender))+
  geom_point()+
  facet_wrap(~Education_Level,scales = "free_x",ncol = 2) + ggtitle("Number Educated vs Salary from 2010-2019")
```
```{r NYC Salary vs Proportion College Educated Over Time}
ggplot(data = SalaryByPropEdu,aes(PropEdu,Salary)) + geom_line(size = 1, col = 'black') + xlab('Proportion With Bachelors Degree') + ylab('Salary') + scale_x_continuous(breaks = breaks_width(0.01)) + geom_point(size = 2.5, col = 'royalblue3') + ylim(30000,65000) + ggtitle("Proportion with Bachelors Degree vs Average NYC Salary from 2010-2019")
```
Observations from Proportion with Bachelors Degree vs Average NYC Salary from 2010-2019:

It seems that in years where the Proportion of people with Bachelor's Degrees increases, that the average salary is higher. This would suggest that when there are more educated people, the typical person earns more.

However, this relationship could very well be coincident and not causal and there is no way given this data to make a determination. It can be seen in the next plot that the total number of Bachelor's Degrees over time is steadily rising over time. Since salaries also tend to rise over time, it isn't clear that salaries would be rising if more people were not becoming more educated.

```{r Proportion College Educated Over Time}
ggplot(data = PropBachelor,aes(Year,PropBachelor)) + geom_line(size = 1, col = 'black') + xlab('Year') + ylab('Proportion With Bachelors Degree') + scale_x_continuous(breaks = seq(2010,2019)) + geom_point(size = 2.5, col = 'royalblue3') + ylim(0.5,.65)
```

Observation of Bachelor's proportions over time:

It appears that the proportion of people with Bachelor's Degrees is steadily increasing over time. In the last 10 years the rate has increased from slightly below 55% to almost 60% which indicates an average increase of almost half a percent per year.

```{r Proportion College Educated Over Time by Gender}
PropBachelorByGenderTidy <- pivot_longer(PropBachelorByGender[,1:3],!Year,names_to = 'Gender',values_to = 'Proportion')

ggplot(PropBachelorByGenderTidy) + geom_line(aes(Year,Proportion,group = Gender, color = Gender), size = 1) + geom_point(aes(Year,Proportion,group = Gender, color = Gender), size = 5) + xlab('Year') + ylab('Proportion With Bachelors Degree') + scale_x_continuous(breaks = seq(2010,2019)) + ylim(.25,.75) + scale_color_manual(values=c('orange','seagreen1'))

ggplot(data = PropBachelorByGender,aes(Year,Difference)) + geom_line(size = 1, col = 'black') + xlab('Year') + ylab('Difference between Male and Female with Bachelors') + scale_x_continuous(breaks = seq(2010,2019)) + geom_point(size = 2.5, col = 'royalblue3') + ylim(-0.05,.05)
```

Observations from Proportion of Males and Females with Bachelors Degrees from 2010-2019:

It seems that in 2010, a larger proportion of females than men had bachelor's degrees. While the proportions are increasing over time for both males and females, it seems that the rate at which a higher proportion of females have bachelors degree is actually faster than it is for males. 

This is confirmed by the gap between the male and female dots on the graph continuing to grow over the course of this decade, and the next plot confirms this.

Observations from Difference in Proportion of Females and Males with a Bachelor's Degree from 2010-2019:

As was able to be seen from the previous plot, the gap between female and male education proportion is growing over time. If trends continue we may see a future where females are significantly more educated than males, even more than they currently are.