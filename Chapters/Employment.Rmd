---
title: "Employment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Imports}
library(tidyverse)
library(RCurl)
library(dplyr)
library(forcats)
```

```{r Data}
AggregateData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/Occupation_Aggregate.csv"))

AggregateYearlyData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/Occupation_Yearly.csv"))

GenderData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/Occupation_Gender_Aggregate.csv"))

YearlyNumEmps <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/YearlyNumEmpsWithNorm.csv"))

AverageEmpsByOccupation <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/AverageEmpsByOccupation.csv"))

BoroughData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/Occupation_County_Aggregate.csv"))

RaceData <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/Occupation_Race_Aggregate.csv"))

PropsByOccupation <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/PropsByOccupation.csv"))

PropsOfGroupByOccupation <- read.csv('C:/Users/eabea/Dropbox/Documents/STAT W5702/Project/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/NumEmp/PropsOfGroupByOccupation.csv')

PropsOfPropsRace <- read.csv('C:/Users/eabea/Dropbox/Documents/STAT W5702/Project/STAT5702_NYC_Employment_Analysis/DataPreprocessing/Data/NumEmp/PropsOfPropsRace.csv')

GenderData$X <- NULL
```

```{r Aggregate Yearly Cleveland Dot Plot filtered into 3 years}
# plot by filtering 3 years
AggregateYearlyData$Occupations <- as.factor(AggregateYearlyData$Occupations)
AggregateYearlyData$year <- as.ordered(AggregateYearlyData$year)


TrimmedAggregateYearlyData <- AggregateYearlyData[AggregateYearlyData$year == "2010" | AggregateYearlyData$year == "2015" | AggregateYearlyData$year == "2019",]

ggplot(TrimmedAggregateYearlyData) +
geom_point(aes(YearlyNumEmp, reorder(Occupations,YearlyNumEmp), color = year)) + ylab('Occupation') + xlab('Number Employed') + ggtitle('Number Employed by Occupation NYC through 2010-2019') 
```

Observations on Number Employed by Occupation NYC through 2010-2019:

The most striking observations from this Cleveland dot plot are where there are clear trends over the decade, that coincide with intuition about the general trend of a sector. Some of the most striking trends are:

1.) Production occupations steadily decreasing over the course of the decade, the only sector where the number of employees for 2010 is lowest of the three years.
2.) Material moving occupations steadily increasing over the course of the decade.
3.) Computer and mathematical as well as architecture and engineering occupations quite quickly increasing over the course of the decade especially relative to their size.
4.) Health care support occupations growing at a stagnant rate from 2010 to 2015, but then growing rapidly from 2015 to 2019.
5.) Food preparation and serving related occupations growing steadily from 2010 to 2019.


```{r Gender Cleveland Dot Plot}
GenderData$Gender <- as.factor(GenderData$Gender)
ggplot(GenderData, aes(MeanNumEmpbyGender,fct_reorder2(Occupations,Gender=='Female',MeanNumEmpbyGender, .desc=FALSE),color = Gender)) + 
  geom_point() +
  ylab('NumEmps') + xlab('Occupations') + ggtitle('Number Employed by Occupations for different genders in NYC')
```


From the figure above, we can see that for some occupations, there are huge distinctions between male occupations and female occupations, while for other some other occupations, there is no huge difference between the number employed of male and female. Therefore, we draw a stacked bar chart with propositions of Male and Female in each occupation to see which occupations have huge relation to gender.

```{r Yearly BoxPlot}
YearlyNumEmps
ggplot(YearlyNumEmps) +
  geom_boxplot(aes(x = YearlyNumEmps$YearlyNumEmp, y = reorder(x = YearlyNumEmps$Occupations,YearlyNumEmps$YearlyNumEmp, FUN = median)),
               color = "black", fill = "dark red", alpha = 0.7) + 
  ggtitle("Number working in sector per year") +
  xlab("Number Employed") + ylab("Occupations") + scale_x_continuous(n.breaks = 13) 

```

Observations from Boxplot of number working in sector per year:

Occupations that seem prone to dramatic fluctuation over time:
Management occupations
Office and administrative support occupations
Health care support occupations
Computer and Mathematical occupations

Occupations where the number of employees has fluctuated very little:
Law enforcement
Fire fighting
Building and grounds keeping occupations
legal occupations

Something to be noted when reading this plot is that the number of people working in any particular occupation may change the viewers perception as to what constitutes more variation. To address this, a second plot has been created in which the box plots are normalized by dividing the number employed in each year by the mean across this sector. While the variation in total number employed won't be apparent, the relative degrees of fluctuation will become more apparent.

```{r Yearly Normalized BoxPlot}
AverageEmpsByOccupation <- read.csv(text = getURL("https://raw.githubusercontent.com/tracy3057/STAT5702_NYC_Employment_Analysis/main/DataPreprocessing/Data/NumEmp/AverageEmpsByOccupation.csv"))

AverageEmpsByOccupation <- AverageEmpsByOccupation[,2:3]
AverageEmpsByOccupation <- dplyr::rename(AverageEmpsByOccupation,NumEmp = X0)

ggplot(YearlyNumEmps) +
  geom_boxplot(aes(x = YearlyNumEmps$Normalized, y = reorder(x = YearlyNumEmps$Occupations,YearlyNumEmps$Normalized, FUN = median)),
               color = "black", fill = "dark red", alpha = 0.7) + 
  ggtitle("Normalized number working in sector per year") +
  xlab("Number Employed") + ylab("Occupations")
```

Observations from number working in sector per year:

In this plot, the total values of employees working in each field in each year are normalized by their averages. In doing this, changes in employment in a sector that on an absolute scale would be small, may be more pronounced as a function of variation relative to it's own size.

In this plot, the average quantity across all years is normalized to one for illustrative purposes, which allows for new interpretations and findings:

1.) Fields such as management which had a large absolute spread from the years 2010-2019 aren't necessarily the ones which seem to display the most variation with respect to themselves. While this field had the largest box in the previous plot, it is in the middle of the pack in this one.

2.) Of the fields with the smallest numbers of workers: Farming, fishing and forestry occupations, Life, physical and social science occupations, Law enforcement occupations, firefighting occupations, and architecture and engineering occupations; The spreads across this decade were shown to be much more profound than in the previous plot, that is with the exception of law enforcement workers and firefighting workers. While the boxes grew somewhat in spread, the growth was not even nearly proportional to that of the other fields. 

This indicates that the number of people working in law enforcement and firefighting is very stable, and this would make sense because a steady supply of people in these roles is necessary. With regards to the other occupations, it also makes sense that relatively unpopulated occupations would be more prone to greater variation as a percent of itself, since relatively few can leave or join, and a big impact can be had.

3.) As a percent of the number of employees working in each sector, the following were most prone to large shifts in number employed:

1.) Farming, fishing and forestry
2.) Material moving occupations
3.) Computer and mathematical occupations
4.) Health technologists and technicians.
5.) Healthcare support occupations

By contrast, these professions were the most stable:

1.) Legal occupations
2.) Sales occupations
3.) Law enforcement workers
4.) Fire fighters
5.) Construction and extraction occupations

```{r, fig.height=15}
NotMonotonous <- AggregateYearlyData[AggregateYearlyData$Occupations == "Office and administrative support occupations" |
                                    AggregateYearlyData$Occupations == "Food preparation and serving related occupations" |
                                    AggregateYearlyData$Occupations == "Transportation occupations"|
                                    AggregateYearlyData$Occupations == "Material moving occupations"|
                                    AggregateYearlyData$Occupations == "Health technologists and technicians"|
                                    AggregateYearlyData$Occupations == "Personal care and service occupations"|
                                    AggregateYearlyData$Occupations == "Building and grounds cleaning and maintenance occupations"|
                                    AggregateYearlyData$Occupations == "Sales and related occupations"|
                                    AggregateYearlyData$Occupations == "Legal occupations"|
                                    AggregateYearlyData$Occupations == "Installation, maintenance, and repair occupations",]
NotMonotonous$year <- as.character(NotMonotonous$year)
NotMonotonous$Occupations <- factor(NotMonotonous$Occupations,levels = c("Office and administrative support occupations",
                                                                         "Food preparation and serving related occupations",
                                                                         "Transportation occupations",
                                                                         "Material moving occupations",
                                                                         "Health technologists and technicians",
                                                                         "Personal care and service occupations",
                                                                         "Building and grounds cleaning and maintenance occupations",
                                                                         "Sales and related occupations",
                                                                         "Legal occupations",
                                                                         "Installation, maintenance, and repair occupations"))

ggplot(NotMonotonous,aes(year,YearlyNumEmp)) +
  geom_point(color = "light blue", size = 10) +
  facet_wrap(~Occupations,ncol=2,scales = "free_y") +
    theme(axis.text=element_text(size=30),
      axis.title=element_text(size=40,face="bold"),
        strip.text.x = element_text(
        size = 35, face = "bold.italic"
        ),
      strip.text.y = element_text(
        size = 35, color = "red", face = "bold.italic"
        ),
      plot.title = element_text(size = 50, face = "bold"))+
  ylab('NumEmps') + xlab('Occupations') + ggtitle('Number Employed by Occupations for Different Occupations in NYC')
```
From the plot above, we can discover that these occupations did not have a monotonous trend and the changing patterns were different as well.
1. Office and administrative support occupations
For this group of occupation, the number of employed maintained at a high level before 2017, while from 2017 to 2019, the number of employees dropped dramatically.
2. Food preparation and serving related occupations
For this group of occupation, the peak of the number of employed appeared in 2015.
3. Transportation occupations
Generally speaking, the number of employed for this group was in an increasing trend. However, from 2018 to 2019, there was a subtle drop, which is the reason that the number of employed in 2019 was smaller than that in 2015.
4. Material moving occupations
For this occupation, the number of employed dropped a little bit from 2010 to 2011, then increased from 2011 to 2012. Afterwards, the number of employees started to decrease again until 2016. Then it had a sudden increase from 2016 to 2018 and maintained at a high level in 2019 with a subtle decrease.
5. Health technologists and technicians
The number of employed maintained at a relatively low value from 2010 to 2013 for this group, then it started to increase until 2015 and maintained at a high level afterwards. However, there was a very low value in 2016, and it seems that there’s a pattern that one year of high value in number of employees will accompanied by a relatively low value for the next year within the years between 2015 to 2019.
6. Personal care and service occupations
Generally speaking, the number of employed in this group was in an increasing trend from 2010 to 2016, then it dropped a little from 2016 to 2017 and dropped a lot from 2017 to 2018, accompanied by a subtle drop from 2018 to 2019.
7. Building and grounds cleaning and maintenance occupations
Form 2010 to 2012, the number of employed people was in a decreasing trend, then the number increased a lot from 2012 to 2013 and continued to decrease from 2013 to 2016. Then it continued to increase for a little bit again from 2016 to 2017, but returned to a dropping trend from 2017 to 2019.
8. Sales and related occupations
The number of employed increased a lot from 2010 to 2011 for this group. Then within the year range from 2011 to 2016, the number remained at a high value, with two relatively low values in 2013 and 2015. However, the number of employed dropped a lot from 2016 to 2018, accompanied by a subtle increase from 2018 to 2019.
9. Legal occupations
Generally speaking, the number of employed for this group was relatively stable, the changing pattern was in the shape of a wave. The two troughs were in year 2013 and 2018 and the two crests were in year 2012 and 2016.
10. Installation, maintenance and repair occupations
The number of employed for this group was relatively stable as well and the changing pattern was also like the shape of a wave. The trough were in year 2016 and the two crests were in year 2013 and 2015.

```{r,fig.height=18}
GenderData$Occupations <- as.factor(GenderData$Occupations)
GenderData$Gender <- as.factor(GenderData$Gender)

GenderData.wide <- pivot_wider(GenderData, names_from = "Gender", values_from = "MeanNumEmpbyGender")
GenderData.wide$difference <- with(GenderData.wide,abs(Male - Female))
GenderData.tidy <- pivot_longer(GenderData.wide, cols = c("Female","Male"), names_to = "Gender", values_to = "NumEmps")

GenderData.tidy <- GenderData.tidy %>% 
  group_by(Occupations) %>% 
  mutate(prop = NumEmps/sum(NumEmps)) %>%
  ungroup()

GenderData.tidy <- GenderData.tidy %>% mutate(difference_pct = difference/sum(NumEmps))

ggplot(GenderData.tidy,aes(x = fct_reorder2(Occupations,Gender == "Female",prop,.desc=FALSE), y=prop,fill=Gender)) + 
  geom_bar(position='fill', stat='identity')+
  ylab('prop') + xlab('Occupations') + ggtitle('Gender Composition by Occupation')+
  theme(axis.text=element_text(size = 20, angle = 90, vjust = 0.5, hjust=1),
        axis.title=element_text(size=30,face="bold"),
        plot.title = element_text(size = 45, face = "bold"))
```


From this plot, we can list the top ten occupations with high percentages of male and the top 10 occupations with high percentages of female.
## Top 10 occupations for male
1. Construction and extraction occupations
2. Installation, maintenance and repair occupations
3. Transportation occupations
4. Material moving occupations
5. Architecture and engineering occupations
6. Fire fighting and prevention, and other protective service workers including supervisors
7. Computer and mathematical occupations
8. Law enforcement workers including supervisors
9. Farming, fishing and forestry occupations
10. Food preparation and serving related occupations

## Top 10 occupations for female
1. Healthcare support occupations
2. Personal care and service occupations
3. Health, design and treating practitioners and other technical occupations
4. Education, training and library occupations
5. Health technologists and technicians
6. Community and social service occupations
7. Office and administrative support occupations
8. Life, physical, and social service occupations
9. Business and financial operations occupations
10. Legal occupations

```{r Race and Gender by Occupation Stacked Bar Charts}
PropsOfPropsRace$Occupation <- as.factor(PropsOfPropsRace$Occupation)
PropsOfPropsRace
PropsOfPropsRace$Occupation <- fct_reorder(PropsOfPropsRace$Occupation, PropsOfPropsRace$White, .desc = FALSE)
PropsOfPropsRace
PropsOfPropsRaceTidy <- pivot_longer(PropsOfPropsRace, cols = c('White','Asian','Hispanic','Black'), names_to = 'race', values_to = 'proportion') 
PropsOfPropsRaceTidy$Occupation <- as.factor(PropsOfPropsRaceTidy$Occupation)
PropsOfPropsRaceTidy
ggplot(PropsOfPropsRaceTidy, aes(fill = race, y = Occupation, x = proportion)) + geom_bar(position = 'stack',stat = 'identity') + ggtitle('Relative Likelihood of Sector Employment by Race') + theme(plot.title = element_text(size = 10, face = "bold"))
```

Observations from Relative Likelihood of Sector Employment by Race:

1.) It seems that a typical white person is much more likely than persons of other races to work legal profession compared to other races. They are also quite likely compared to other races to engage in Management occupations, physical, life and social science occupations, and art, design, entertainment, sports and media occupations.
2.) It seems that a typical white person is much less likely than persons of other races to work in health care support occupations, transportation occupations, production occupations, personal care and service occupations, material moving operations, and building and grounds cleaning and maintenance occupations
3.) It seems that a typical Hispanic person is much more likely than person of other races to work in Farming, Fishing and forestry occupations. They are also quite likely compared to other races to engage in building and grounds cleaning and maintenance occupations, construction and extraction operations, and material moving operations.
4.) It seems that a typical Hispanic person is much less likely than persons of other races to work in health diagnosing and treating practitioners and other technical occupations, business and financial operations, computer and mathematical occupations, legal occupations, art, design, entertainment, sports, and media occupations, architecture and engineering occupations, and life, physical, and social science occupations.
5.) It seems that a typical Black person is much more likely than persons of other races to work in fire fighting and prevention and other protective services including supervisors, law enforcement workers including supervisors, healthcare and support occupations, and community and social service occupations.
6.) It seems that a typical Black person is much less likely than persons of other races to work in architecture and engineering occupations, art, design, entertainment, sports and media occupations, farming, fishing, and forestry occupations, food preparation and serving occupations, life, physical and social science occupations, and legal occupations.
7.) It seems that a typical Asian person is much more likely than persons of other races to work in computer and mathematical operations, architecture and engineering operations, business and financial operations, health diagnosing and treating practitioners and other technical occupations.
8.) It seems that a typical Asian person is much less likely than persons of other races to work in Law enforcement occupations, fire fighting and prevention occupations, community and social service occupations, and building and grounds cleaning and maintenance occupations.

